DROP DATABASE IF EXISTS ECommerceDB;
CREATE DATABASE ECommerceDB;
USE ECommerceDB;

CREATE TABLE Users (
	`UserId` INT PRIMARY KEY AUTO_INCREMENT,
    `UserName` VARCHAR(50) UNIQUE NOT NULL,
    `PasswordHash` VARCHAR(255) NOT NULL,
    `email` VARCHAR(100) UNIQUE NOT NULL,
    `createAt` DATETIME
);

CREATE TABLE Orders (
	`OrderID` INT PRIMARY KEY AUTO_INCREMENT,
    `OrderDate` DATE,
    `UserId` INT,
    TotalAmount DECIMAL(10,2),
    CHECK (TotalAmount > 0),
    FOREIGN KEY (UserId) REFERENCES Users(UserId)
);

CREATE TABLE Products (
	`ProductId` INT PRIMARY KEY AUTO_INCREMENT,
    `ProductName` VARCHAR(50) UNIQUE NOT NULL,
    `description` TEXT,
    `price` DECIMAL(10, 2) NOT NULL,
    `stock` INT NOT NULL
);

CREATE TABLE OrderDetails (
	`OrderDetailID` INT PRIMARY KEY AUTO_INCREMENT,
    `OrderID` INT,
    `ProductID` INT, 
    `Quantity` INT NOT NULL,
    `PriceAtOrder` DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (OrderID) REFERENCES Orders(OrderID),
    FOREIGN KEY (ProductId) REFERENCES Products(ProductId)
);

CREATE TABLE Reviews (
	`ReviewId` INT PRIMARY KEY AUTO_INCREMENT,
    `ProductID` INT,
    `UserId` INT,
    `rating` INT,
    `reviewText` text,
    `createAt` DATETIME,
    FOREIGN KEY (ProductId) REFERENCES Products(ProductId),
    FOREIGN KEY (UserId) REFERENCES Users(UserId)
);
